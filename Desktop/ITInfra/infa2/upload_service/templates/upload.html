<!DOCTYPE html>
<html>
<head><title>Upload Video</title></head>
<body>
<h2>Upload Service</h2>
<p>Logged in as <b>{{ username }}</b> | <a href="/logout">Logout</a></p>
<hr>

{% for msg in get_flashed_messages() %}<p><b>{{ msg }}</b></p>{% endfor %}

<h3>Upload a Video</h3>
<form method="POST" enctype="multipart/form-data">
  <p>Title: <input type="text" name="title" placeholder="Leave blank to use filename"></p>
  <p>Video file: <input type="file" name="video" accept="video/*" required></p>
  <p><button type="submit">Upload</button></p>
</form>

<hr>
<h3>Uploaded Videos ({{ videos|length }})</h3>
{% if videos %}
<table border="1" cellpadding="6">
  <tr><th>Title</th><th>Uploaded by</th><th>Date</th><th>Size</th><th>Watch</th></tr>
  {% for v in videos %}
  <tr>
    <td>{{ v.title }}</td>
    <td>{{ v.username }}</td>
    <td>{{ v.uploaded_at[:10] if v.uploaded_at else '-' }}</td>
    <td>{{ (v.file_size / 1048576)|round(1) if v.file_size else '-' }} MB</td>
    <td><a href="{{ stream_url }}/watch/{{ v.id }}" target="_blank">Watch on Stream Service</a></td>
  </tr>
  {% endfor %}
</table>
{% else %}
<p>No videos uploaded yet.</p>
{% endif %}

<hr>
<p><small>To watch videos, go to the <a href="{{ stream_url }}">Stream Service (port 5004)</a></small></p>
</body>
</html>
